{% extends 'balances/base.html' %}
{% load static %}
{% block content %}
      <!-- Main Content Wrapper -->
      <main class="main-content w-full px-[var(--margin-x)] pb-8">
        <div
          class="mt-4 grid grid-cols-12 gap-4 sm:mt-5 sm:gap-5 lg:mt-6 lg:gap-6"
        >
          <div
            class="col-span-12 grid grid-cols-12 rounded-lg bg-gradient-to-r from-blue-500 to-indigo-600 py-5 sm:py-6"
          >
            <div class="col-span-12 sm:col-span-6 lg:col-span-6">
              <div class="px-4 text-white sm:px-5">
                <div class="-mt-1 flex items-center space-x-2">
                  <h2 class="text-base font-medium tracking-wide">Balance</h2>


                </div>

                <div class="mt-3">
                  <p class="text-2xl font-semibold"> <span id="current-balance">{{current_balance.balance|floatformat:1}}</span> KWh</p>
                </div>

                <div class="mt-4 flex space-x-7">
                  <div>
                    <p class="text-indigo-100">Last TopUp</p>
                    <div class="mt-1 flex items-center space-x-2">
                      <div
                        class="flex h-7 w-7 items-center justify-center rounded-full bg-black/20"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-4 w-4"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M7 11l5-5m0 0l5 5m-5-5v12"
                          />
                        </svg>
                      </div>
                      <p class="text-base font-medium">02 Jan 2024</p>
                    </div>
                  </div>
                  <div>
                    <p class="text-indigo-100">Amount</p>
                    <div class="mt-1 flex items-center space-x-2">
                      <div
                        class="flex h-7 w-7 items-center justify-center rounded-full bg-black/20"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-4 w-4"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 13l-5 5m0 0l-5-5m5 5V6"
                          />
                        </svg>
                      </div>
                      <p class="text-base font-medium">240 Units</p>
                    </div>
                  </div>

                  <div>
                    <p class="text-indigo-100">Predicted Range</p>
                    <div class="mt-1 flex items-center space-x-2">
                      <div
                        class="flex h-7 w-7 items-center justify-center rounded-full bg-black/20"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-4 w-4"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17 13l-5 5m0 0l-5-5m5 5V6"
                          />
                        </svg>
                      </div>
                      <p class="text-base font-medium">24 Days</p>
                    </div>
                  </div>

                </div>
              </div>
            </div>

            <div class="col-span-12 mt-5 sm:col-span-6 sm:mt-0 lg:col-span-6">
              <div
                class="swiper px-5 sm:pl-0"
                x-init="$nextTick(()=>new Swiper($el,{  slidesPerView: 'auto', spaceBetween: 16}))"
              >
                <div class="swiper-wrapper">
                  <div
                    class="swiper-slide relative h-40 w-64 shrink-0 rounded-lg bg-gradient-to-br from-[#ffffff55] to-[#ffffff20]"
                  >
                    <div
                      class="absolute inset-0 flex flex-col justify-between rounded-lg border border-white/10 p-5"
                    >
                      <!-- <div class="flex items-center justify-between"> -->
                         <!-- </div> -->
                        <div class="text-white">
                          <p class="text-lg font-semibold tracking-wide">
                            METER NUMBER
                          </p>
                        </div>

                     
                      <div class="text-white">
                        <p class="text-lg font-semibold tracking-wide">
                          {{meter_details.meter_number}}
                        </p>
                        <p class="mt-1 text-xs font-medium">
                          {{meter_details.}}
                        </p>
                      </div>
                    </div>
                  </div>

                  <div
                    class="swiper-slide relative h-40 w-64 shrink-0 rounded-lg bg-gradient-to-br from-[#ffffff55] to-[#ffffff20]"
                  >
                    <div
                      class="absolute inset-0 flex flex-col justify-between rounded-lg border border-white/10 p-5"
                    >
                      <!-- <div class="flex items-center justify-between"> -->
                         <!-- </div> -->
                        <div class="text-white">
                          <p class="text-lg font-semibold tracking-wide">
                            LOCATION
                          </p>
                        </div>

                     
                      <div class="text-white">
                        <p class="text-lg font-semibold tracking-wide">
                          {{meter_details.location|upper}}
                        </p>
                        <p class="mt-1 text-xs font-medium">
                          {{meter_details.house_number}}
                        </p>
                      </div>
                    </div>
                  </div>

                </div>
              </div>
            </div>
          </div>

          <!-- graph section -->
          <div class="card col-span-12 pb-5 lg:col-span-8">


                            
            <div
            class="mt-3 flex h-8 items-center justify-between px-4 sm:px-5"
          >
            <h2
              class="line-clamp-1 font-medium tracking-wide text-slate-700 dark:text-navy-100"
            >
              Usage
            </h2>

            <div
              x-data="usePopper({placement:'bottom-end',offset:4})"
              @click.outside="isShowPopper && (isShowPopper = false)"
              class="inline-flex"
            >
              <button
                x-ref="popperRef"
                @click="isShowPopper = !isShowPopper"
                class="btn -mr-1.5 h-8 w-8 rounded-full p-0 hover:bg-slate-300/20 focus:bg-slate-300/20 active:bg-slate-300/25 dark:hover:bg-navy-300/20 dark:focus:bg-navy-300/20 dark:active:bg-navy-300/25"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-5 w-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"
                  />
                </svg>
              </button>

              <div
                x-ref="popperRoot"
                class="popper-root"
                :class="isShowPopper && 'show'"
              >
                <div
                  class="popper-box rounded-md border border-slate-150 bg-white py-1.5 font-inter dark:border-navy-500 dark:bg-navy-700"
                >
                  <ul>
                    <li>
                      <a
                        href="#"
                        class="flex h-8 items-center px-3 pr-8 font-medium tracking-wide outline-none transition-all hover:bg-slate-100 hover:text-slate-800 focus:bg-slate-100 focus:text-slate-800 dark:hover:bg-navy-600 dark:hover:text-navy-100 dark:focus:bg-navy-600 dark:focus:text-navy-100"
                        >Action</a
                      >
                    </li>
                    <li>
                      <a
                        href="#"
                        class="flex h-8 items-center px-3 pr-8 font-medium tracking-wide outline-none transition-all hover:bg-slate-100 hover:text-slate-800 focus:bg-slate-100 focus:text-slate-800 dark:hover:bg-navy-600 dark:hover:text-navy-100 dark:focus:bg-navy-600 dark:focus:text-navy-100"
                        >Another Action</a
                      >
                    </li>
                    <li>
                      <a
                        href="#"
                        class="flex h-8 items-center px-3 pr-8 font-medium tracking-wide outline-none transition-all hover:bg-slate-100 hover:text-slate-800 focus:bg-slate-100 focus:text-slate-800 dark:hover:bg-navy-600 dark:hover:text-navy-100 dark:focus:bg-navy-600 dark:focus:text-navy-100"
                        >Something else</a
                      >
                    </li>
                  </ul>
                  <div
                    class="my-1 h-px bg-slate-150 dark:bg-navy-500"
                  ></div>
                  <ul>
                    <li>
                      <a
                        href="#"
                        class="flex h-8 items-center px-3 pr-8 font-medium tracking-wide outline-none transition-all hover:bg-slate-100 hover:text-slate-800 focus:bg-slate-100 focus:text-slate-800 dark:hover:bg-navy-600 dark:hover:text-navy-100 dark:focus:bg-navy-600 dark:focus:text-navy-100"
                        >Separated Link</a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="ax-transparent-gridline pr-2">
            <div
              x-init="$nextTick(() => { $el._x_chart = new ApexCharts($el,pages.charts.incomePersonal); $el._x_chart.render() });"
            ></div>
          </div>


          
        </div>


          <!-- Recharge section -->
          <div class="card col-span-12 px-4 pb-5 sm:px-5 lg:col-span-4">
            <div class="flex items-center justify-between py-3">
              <h2
                class="font-medium tracking-wide text-slate-700 dark:text-navy-100"
              >
                Recharge Units
              </h2>
              <div
                x-data="usePopper({placement:'bottom-end',offset:4})"
                @click.outside="isShowPopper && (isShowPopper = false)"
                class="inline-flex"
              >
                <button
                  x-ref="popperRef"
                  @click="isShowPopper = !isShowPopper"
                  class="btn -mr-1 h-8 w-8 rounded-full p-0 hover:bg-slate-300/20 focus:bg-slate-300/20 active:bg-slate-300/25 dark:hover:bg-navy-300/20 dark:focus:bg-navy-300/20 dark:active:bg-navy-300/25"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"
                    />
                  </svg>
                </button>

                <div
                  x-ref="popperRoot"
                  class="popper-root"
                  :class="isShowPopper && 'show'"
                >
                  <div
                    class="popper-box rounded-md border border-slate-150 bg-white py-1.5 font-inter dark:border-navy-500 dark:bg-navy-700"
                  >
                    <ul>
                      <li>
                        <a
                          href="#"
                          class="flex h-8 items-center px-3 pr-8 font-medium tracking-wide outline-none transition-all hover:bg-slate-100 hover:text-slate-800 focus:bg-slate-100 focus:text-slate-800 dark:hover:bg-navy-600 dark:hover:text-navy-100 dark:focus:bg-navy-600 dark:focus:text-navy-100"
                          >Action</a
                        >
                      </li>
                      <li>
                        <a
                          href="#"
                          class="flex h-8 items-center px-3 pr-8 font-medium tracking-wide outline-none transition-all hover:bg-slate-100 hover:text-slate-800 focus:bg-slate-100 focus:text-slate-800 dark:hover:bg-navy-600 dark:hover:text-navy-100 dark:focus:bg-navy-600 dark:focus:text-navy-100"
                          >Another Action</a
                        >
                      </li>
                      <li>
                        <a
                          href="#"
                          class="flex h-8 items-center px-3 pr-8 font-medium tracking-wide outline-none transition-all hover:bg-slate-100 hover:text-slate-800 focus:bg-slate-100 focus:text-slate-800 dark:hover:bg-navy-600 dark:hover:text-navy-100 dark:focus:bg-navy-600 dark:focus:text-navy-100"
                          >Something else</a
                        >
                      </li>
                    </ul>
                    <div class="my-1 h-px bg-slate-150 dark:bg-navy-500"></div>
                    <ul>
                      <li>
                        <a
                          href="#"
                          class="flex h-8 items-center px-3 pr-8 font-medium tracking-wide outline-none transition-all hover:bg-slate-100 hover:text-slate-800 focus:bg-slate-100 focus:text-slate-800 dark:hover:bg-navy-600 dark:hover:text-navy-100 dark:focus:bg-navy-600 dark:focus:text-navy-100"
                          >Separated Link</a
                        >
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            

            <div class="mt-2 space-y-4">
              <label class="block">
                <span class="text-xs+">Pay to</span>
                <input
                  x-input-mask="{
                          creditCard: true
                      }"
                  class="form-input mt-1.5 h-9 w-full rounded-lg border border-slate-300 bg-transparent px-3 py-2 placeholder:text-slate-400/70 hover:border-slate-400 focus:border-primary dark:border-navy-450 dark:hover:border-navy-400 dark:focus:border-accent"
                  placeholder="1224 653 965 2356"
                  type="text"
                />
              </label>
              <div>
                <span class="text-xs+">Amount</span>

                <div class="mt-1.5 flex h-9 -space-x-px">
                  <select
                    class="form-select rounded-l-lg border border-slate-300 bg-white px-3 py-2 pr-9 hover:z-10 hover:border-slate-400 focus:z-10 focus:border-primary dark:border-navy-450 dark:bg-navy-700 dark:hover:border-navy-400 dark:focus:border-accent"
                  >
                    <option>MK</option>
                  </select>
                  <input
                    class="form-input w-full rounded-r-lg border border-slate-300 bg-transparent px-3 py-2 placeholder:text-slate-400/70 hover:z-10 hover:border-slate-400 focus:z-10 focus:border-primary dark:border-navy-450 dark:hover:border-navy-400 dark:focus:border-accent"
                    placeholder="Amount"
                    type="text"
                  />
                </div>
              </div>
            </div>

            <button
              class="btn mt-5 h-10 w-full bg-primary font-medium text-white hover:bg-primary-focus focus:bg-primary-focus active:bg-primary-focus/90 dark:bg-accent dark:hover:bg-accent-focus dark:focus:bg-accent-focus dark:active:bg-accent/90"
            >
              Recharge Now
            </button>
          </div>
        </div>
      </main>
      <script>
          // Establish a WebSocket connection
          const socket = new WebSocket(`wss://${window.location.host}/ws/balance/{{meter_details.meter_number}}/`);

          // Get the HTML element where the balance will be displayed
          const balanceElement = document.getElementById('current-balance');

          // Handle the WebSocket connection open event
          socket.onopen = function(event) {
              console.log('WebSocket connection opened');
          };

          // Handle incoming WebSocket messages
          socket.onmessage = function(event) {
              const data = JSON.parse(event.data);

              // Assuming the WebSocket message contains the updated balance
              if (data.balance !== undefined) {
                  const updatedBalance = parseFloat(data.balance).toFixed(1); // Round to 1 decimal place
                  balanceElement.textContent = updatedBalance;
              }
          };

          // Handle WebSocket connection close event
          socket.onclose = function(event) {
              console.log('WebSocket connection closed', event);
          };

          // Handle WebSocket errors
          socket.onerror = function(error) {
              console.error('WebSocket error:', error);
          };
      </script>
{% endblock content %}